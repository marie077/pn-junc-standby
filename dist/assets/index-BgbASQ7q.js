import*as o from"https://unpkg.com/three@0.163.0/build/three.module.js";import{MathUtils as te}from"https://unpkg.com/three@0.163.0/src/math/MathUtils.js";import{ImprovedNoise as Pe}from"https://unpkg.com/three@0.163.0/examples/jsm/math/ImprovedNoise.js";import*as Se from"https://unpkg.com/three@0.163.0/examples/jsm/utils/BufferGeometryUtils.js";import{Vector3 as ue}from"https://unpkg.com/three@0.163.0/src/math/Vector3.js";import"https://unpkg.com/three@0.163.0/examples/jsm/controls/TransformControls.js";import"https://unpkg.com/three@0.163.0/examples/jsm/controls/OrbitControls.js";import{XRButton as Fe}from"https://unpkg.com/three@0.163.0/examples/jsm/webxr/XRButton.js";import{XRControllerModelFactory as Ve}from"https://unpkg.com/three@0.163.0/examples/jsm/webxr/XRControllerModelFactory.js";import{TextGeometry as ye}from"https://unpkg.com/three@0.163.0/examples/jsm/geometries/TextGeometry.js";import{FontLoader as Ce}from"https://unpkg.com/three@0.163.0/examples/jsm/loaders/FontLoader.js";import{RGBELoader as Le}from"https://unpkg.com/three@0.163.0/examples/jsm/loaders/RGBELoader.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function r(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=r(n);fetch(n.href,a)}})();const Te="/pn-junc-three/moonless_golf_1k.hdr";let x,S,p,b,T,R;const oe=document.getElementById("voltage");let P=.22,I=.88,W,f=[],d=[],h=50,c=new o.Vector3(150,75,75),ze=new o.Clock;c.y;let Ge=-(c.x/2)+1,qe=c.x/2-1,K,g=25,ne,re,A,M=0,Be="Voltage: "+M,D,Y;const Ee=.1;let Re=.5,V=2;const C=new Pe;let z=[],G=[],Q=[],ae=30,ee=!1,ie=!1,le=!1,N=[],B,E,k,X,j;const _={leftController:{thumbstick:{x:0,y:0},trigger:0,triggerPressed:!1},rightController:{thumbstick:{x:0,y:0},trigger:0,triggerPressed:!1}},J={moveSpeed:2,rotationSpeed:.05},$=new Ce;_e();De();setInterval(()=>{Ze()},2e3);function _e(){const t=[{nv:.1,quantity:3},{nv:.2,quantity:10},{nv:.3,quantity:21},{nv:.4,quantity:35},{nv:.5,quantity:49},{nv:.6,quantity:63},{nv:.7,quantity:74},{nv:.8,quantity:82},{nv:.9,quantity:86},{nv:1,quantity:86},{nv:1.1,quantity:83},{nv:1.2,quantity:77},{nv:1.3,quantity:69},{nv:1.4,quantity:59},{nv:1.5,quantity:50},{nv:1.6,quantity:40},{nv:1.7,quantity:32},{nv:1.8,quantity:24},{nv:1.9,quantity:18},{nv:3,quantity:13},{nv:2.1,quantity:9},{nv:2.2,quantity:6},{nv:2.3,quantity:4},{nv:3.5,quantity:3},{nv:4,quantity:2},{nv:5,quantity:1},{nv:6,quantity:1}];for(let m=0;m<t.length;m++){let y=0;for(;y<t[m].quantity;)Q.push(t[m].nv),y++}if(x=document.getElementById("three-container-scene-1"),p=new o.Scene,new Le().load(Te,function(m){m.mapping=o.EquirectangularReflectionMapping,m.format=o.RGBAFormat,m.minFilter=o.LinearFilter,m.magFilter=o.LinearFilter,m.generateMipmaps=!1,p.environment=m,p.background=m}),S=new o.PerspectiveCamera(75,x.clientWidth/x.clientHeight,.1,1500),S.position.z=150,b=new o.WebGLRenderer({alpha:!1}),b.setSize(x.clientWidth,x.clientHeight),b.xr.enabled=!0,b.xr.setReferenceSpaceType("local-floor"),Ue(),x.appendChild(b.domElement),x.appendChild(Fe.createButton(b)),j=new o.Object3D,Ie(),!x){console.error("Container not found");return}const e=new o.AmbientLight(16777215,3);p.add(e),R=new dat.GUI,T={translateZ:150,translateX:0,rotateY:te.degToRad(0)},document.getElementById("myText").innerHTML=0,R.add(T,"translateX",-100,100).onChange(()=>{S.position.x=T.translateX}),R.add(T,"translateZ",-50,150).onChange(()=>{S.position.z=T.translateZ}),R.add(T,"rotateY",-50,50).onChange(()=>{S.rotation.y=te.degToRad(T.rotateY)});const r={"Reset Cube":$e};R.add(r,"Reset Cube"),oe.addEventListener("input",()=>{M=parseFloat(oe.value),document.getElementById("myText").innerHTML=M}),window.addEventListener("resize",tt),$.load("https://unpkg.com/three@0.163.0/examples/fonts/helvetiker_regular.typeface.json",function(m){$._font=m,Y=new ye(Be,{font:m,size:5,depth:.5});const y=new o.MeshBasicMaterial({color:16777215});D=new o.Mesh(Y,y),D.position.set(-20,60,0),p.add(D)});const i=new o.CurvePath,n=[new o.Vector3(-75,0,10),new o.Vector3(-120,0,10),new o.Vector3(-120,-65,10),new o.Vector3(-30,-65,10)];for(let m=0;m<n.length-1;m++){const y=new o.LineCurve3(n[m],n[m+1]);i.add(y)}const a=new o.BufferGeometry().setFromPoints(i.getPoints(50)),s=new o.LineBasicMaterial({color:16777215}),u=new o.Line(a,s);p.add(u);const l=new o.CurvePath,F=[new o.Vector3(75,0,10),new o.Vector3(120,0,10),new o.Vector3(120,-65,10),new o.Vector3(30,-65,10)];for(let m=0;m<F.length-1;m++){const y=new o.LineCurve3(F[m],F[m+1]);l.add(y)}const v=new o.BufferGeometry().setFromPoints(l.getPoints(50)),w=new o.LineBasicMaterial({color:16777215}),ge=new o.Line(v,w);p.add(ge);const ve=be(c.x,c.y,c.z),Me=new o.LineDashedMaterial({color:16777215,dashSize:3,gapSize:1});W=new o.LineSegments(ve,Me),W.computeLineDistances(),W.position.set(0,0,0);const he=new o.CylinderGeometry(10,10,60,32),we=new o.WireframeGeometry(he),q=new o.LineSegments(we);q.rotateZ(Math.PI/2),q.material.depthTest=!1,q.material.opacity=.25,q.material.transparent=!0,q.position.set(0,-70,0),p.add(q);const xe=new o.PlaneGeometry(c.z,c.y),je=new o.LineDashedMaterial({color:16777215,dashSize:3,gapSize:1});let O=new o.LineSegments(xe,je);O.computeLineDistances(),O.position.set(0,0,0),O.rotateY(Math.PI/2),p.add(W,O);let H;for(let m=0;m<h;m++){H=L();let y=pe(m,-(c.x/2)+1,-2,16724273,!1);me(-(c.x/2)+1,-2,16777215,"acceptor"),d.push({value:"h",initPos:y.object.position,crossReady:!0,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,recombine:!0,canMove:!0,id:"normal",object:y.object,material:y.material,velocity:H,speed:Math.random()*(I-P+1)+P,scatterStartTime:performance.now(),scatterTime:V+(C.noise(m*100,m*200,performance.now()*.001)-.5)*.3})}for(let m=0;m<h;m++){H=L(),me(2,c.x/2-1,16777215,"donor");let y=pe(m,2,c.x/2-1,2052607,!1);f.push({value:"e",initPos:y.object.position,crossReady:!0,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,recombine:!0,canMove:!0,id:"normal",object:y.object,material:y.material,velocity:H,speed:Math.random()*(I-P+1)+P,scatterStartTime:performance.now(),scatterTime:V+(C.noise(m*100,m*200,performance.now()*.001)-.5)*.3})}}function De(){b.setAnimationLoop(function(t,e){if(e){const u=e.session;if(u){let l={left:!1,right:!1};Array.from(u.inputSources).forEach(v=>{if(!v.gamepad)return;const w=v.handedness==="left"?_.leftController:_.rightController;v.gamepad.axes.length>=4&&(w.thumbstick.x=v.gamepad.axes[2]||0,w.thumbstick.y=v.gamepad.axes[3]||0,w.trigger=Math.abs(v.gamepad.buttons[0].value),w.triggerPressed=w.trigger>Ee,w===_.rightController&&w.triggerPressed&&!l.right?(M=Math.min(.4,M+.1),l.right=w.triggerPressed):w===_.leftController&&w.triggerPressed&&!l.left&&(M=Math.max(-1.4,M-.1),l.left=w.triggerPressed),D&&(D.geometry.dispose(),Y=new ye("Voltage: "+M.toFixed(2),{font:$._font,size:5,depth:.5}),D.geometry=Y))})}}let r=performance.now(),i=ze.getDelta()/15;p.remove(A),g=24.2*(.58*Math.sqrt(9.2-M*1.13/.05)),ne=be(g,c.y,c.z),re=new o.LineDashedMaterial({color:16711680,dashSize:3,gapSize:1}),A=new o.LineSegments(ne,re),A.computeLineDistances(),A.position.set(0,0,0),p.add(A);let n=new o.Vector3(g/2,0,0);if(et(n,g,16776960),Je(r),de(f,g,i,-1),de(d,g,i,1),Ne(),Ye(),We(),M<0&&(Z(f,"e"),Z(d,"h")),M>0&&(Z(f,"e"),Z(d,"h"),ee)){let u=new o.Vector3(c.x/2+50,0,0),l=U(u,2052607,!1);l.value="e",z.push(l);let F=new o.Vector3(-c.x/2-50,0,0),v=U(F,16724273,!1);v.value="h",z.push(v)}z.length>0&&Oe(),G.length>0&&ke(),He(),Qe(d,f,Ge,qe),Ae(),b.render(p,S)})}function se(t){let e,r;switch(t.targetRayMode){case"tracked-pointer":return e=new o.BufferGeometry,e.setAttribute("position",new o.Float32BufferAttribute([0,0,0,0,0,-1],3)),e.setAttribute("color",new o.Float32BufferAttribute([.5,.5,.5,0,0,0],3)),r=new o.LineBasicMaterial({vertexColors:!0,blending:o.AdditiveBlending}),new o.Line(e,r);case"gaze":return e=new o.RingGeometry(.02,.04,32).translate(0,0,-1),r=new o.MeshBasicMaterial({opacity:.5,transparent:!0}),new o.Mesh(e,r)}}function Ie(){j=new o.Object3D,j.position.set(0,0,0),j.add(S),p.add(j),B=b.xr.getController(0),E=b.xr.getController(1),B.addEventListener("selectstart",ce),B.addEventListener("selectend",fe),B.addEventListener("connected",function(e){this.add(se(e.data))}),B.addEventListener("disconnected",function(){this.remove(this.children[0])}),E.addEventListener("selectstart",ce),E.addEventListener("selectend",fe),E.addEventListener("connected",function(e){this.add(se(e.data))}),E.addEventListener("disconnected",function(){this.remove(this.children[0])});const t=new Ve;k=b.xr.getControllerGrip(0),X=b.xr.getControllerGrip(1),k.add(t.createControllerModel(k)),X.add(t.createControllerModel(X)),j.add(B),j.add(E),j.add(k),j.add(X)}async function Ue(t){const e=await navigator.xr.requestSession("immersive-vr"),r=e.inputSources[0];k=e.requestReferenceSpace("local"),console.log("number of input sources:"+r.length)}function Ae(){if(!b.xr.isPresenting)return;const t=_.leftController.thumbstick,e=_.rightController.thumbstick;Math.abs(t.y)>.1&&(j.position.z+=t.y*J.moveSpeed),Math.abs(t.x)>.1&&(j.position.x+=t.x*J.moveSpeed),Math.abs(e.x)>.1&&(j.rotation.y-=e.x*J.rotationSpeed)}function ce(){this.userData.isSelecting=!0}function fe(){this.userData.isSelecting=!1}function ke(){for(let t=G.length-1;t>=0;t--){let e=G[t],r=e.object.position;if(e.value=="e")if(r.x<=c.x/2)e.object.position.add(new o.Vector3(.2,0,0));else{e.object.position.add(new o.Vector3(.2,0,0)),e.object.material.transparent=!0;let i=Math.abs(e.object.position.x-c.x/2),a=o.MathUtils.clamp(1-i/50,0,1);e.object.material.opacity=a,a<=0&&(p.remove(e.object),G.splice(t,1))}else if(e.value=="h")if(r.x>=-c.x/2)e.object.position.add(new o.Vector3(-.2,0,0));else{e.object.position.add(new o.Vector3(-.2,0,0)),e.object.material.transparent=!0;let i=Math.abs(e.object.position.x+c.x/2),a=o.MathUtils.clamp(1-i/50,0,1);e.object.material.opacity=a,a<=0&&(p.remove(e.object),G.splice(t,1))}}}function Oe(){for(let t=z.length-1;t>=0;t--){let e=z[t],r=e.object.position;e.value=="e"?r.x<c.x/2-1?(f.push({value:"h",crossReady:!0,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,recombine:!0,id:"generated",canMove:!0,object:e.object,material:e.material,velocity:L(),speed:Math.random()*(I-P+1)+P,scatterStartTime:performance.now(),scatterTime:V+(C.noise(Math.random(0,h)*100,Math.random(0,h)*200,performance.now()*.001)-.5)*.3}),z.splice(t,1)):e.object.position.add(new o.Vector3(-.2,0,0)):e.value=="h"&&(r.x>-c.x/2+1?(d.push({value:"h",crossReady:!0,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,recombine:!0,id:"generated",canMove:!0,object:e.object,material:e.material,velocity:L(),speed:Math.random()*(I-P+1)+P,scatterStartTime:performance.now(),scatterTime:V+(C.noise(Math.random(0,h)*100,Math.random(0,h)*200,performance.now()*.001)-.5)*.3}),z.splice(t,1)):e.object.position.add(new o.Vector3(.2,0,0)))}}function Z(t,e){let r=0,i=0;for(let n=0;n<t.length;n++){let a=t[n].object.position.x;if(M<0||M>0){if(e=="e"){if(a>g/2&&(r=r+1,r>h)){r=r-1;let s=new o.Vector3(c.x/2-5,0,0),u=U(s,2052607,!1);u.value="e",t[n].crossed=!0,G.push(u);let l=Math.floor(Math.random()*f.length);p.remove(f[l].object),f[l].object.geometry.dispose(),f[l].object.material.dispose(),f.splice(l,1)}}else if(e=="h"&&a<-g/2&&(i=i+1,i>h)){i=i-1;let s=new o.Vector3(-c.x/2+5,0,0),u=U(s,16724273,!1);u.value="h",t[n].crossed=!0,G.push(u);let l=Math.floor(Math.random()*d.length);p.remove(d[l].object),d[l].object.geometry.dispose(),d[l].object.material.dispose(),d.splice(l,1)}}if(M===0){if(e=="e"){if(a>g/2&&(r=r+1,r>h)){r=r-1;let s=Math.floor(Math.random()*f.length);p.remove(f[s].object),f[s].object.geometry.dispose(),f[s].object.material.dispose(),f.splice(s,1)}}else if(e=="h"&&a<-g/2&&(i=i+1,i>h)){i=i-1;let s=Math.floor(Math.random()*d.length);p.remove(d[s].object),d[s].object.geometry.dispose(),d[s].object.material.dispose(),d.splice(s,1)}}}}function de(t,e,r,i){for(let n=0;n<t.length;n++){let a=t[n].object.position.x,s=new o.Vector3(0,0,0);-e/2<a&&a<0&&(s=new o.Vector3(-1.53*(e/2+a),0,0)),0<a&&a<e/2&&(s=new o.Vector3(-1.53*(e/2-a),0,0)),(-c.x/2+1<a&&a<-e/2||e/2<a&&a<c.x/2-1||a==0)&&(s=new o.Vector3(0,0,0)),i<0?f[n].velocity.add(s.multiplyScalar(r).multiplyScalar(i)):d[n].velocity.add(s.multiplyScalar(r))}}function He(){for(let r of[...f,...d]){const i=r.velocity.clone();i.clampLength(.9,30),r.canMove==!0&&(r.object.position.add(i),r.velocity=i)}}function We(){let i;for(let n=0;n<f.length;n++)for(let a=0;a<d.length;a++)!f[n]||!d[a]||(ie=f[n].object.position.x<-g/2-20||f[n].object.position.x>g/2+20,le=d[a].object.position.x<-g/2-20||d[a].object.position.x>g/2+20,ie&&le&&(Ke(f[n],d[a])?!f[n].lerping&&!d[a].lerping&&(f[n].lerping=!0,d[a].lerping=!0,f[n].lerpPartner=d[a],d[a].lerpPartner=f[n],f[n].pauseCounter=0,d[a].pauseCounter=0,f[n].lerpProgress=0,d[a].lerpProgress=0,f[n].velocity.set(0,0,0),d[a].velocity.set(0,0,0),i=new o.Vector3().addVectors(f[n].object.position,d[a].object.position).multiplyScalar(.5),f[n].targetPosition=i.clone(),d[a].targetPosition=i.clone()):ee=!1));for(let n of[...f,...d])if(n.processed=!1,n.lerping&&!n.processed)if(n.processed=!0,console.log("lerping detected"),n.orbCreated=!1,n.pauseCounter<60)n.pauseCounter++;else{if(n.lerpProgress+=.01,n.object.position.lerp(n.targetPosition,n.lerpProgress),n.lerpProgress<=.25&&!n.orb&&!n.orbCreated){const a=new o.SphereGeometry(3,32,32),s=new o.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.4}),u=new o.Mesh(a,s);u.position.copy(n.targetPosition),n.orb=u,n.orb.gradualVal=3,n.orbCreated=!0,p.add(n.orb)}n.orb?(console.log("orb exists"),n.orb.position.copy(n.targetPosition),n.orb.scale.setScalar(n.orb.gradualVal),n.orb.gradualVal-=.05,n.orb.material.opacity=.3*Math.max(0,n.orb.gradualVal),n.orb.material.opacity<=.04?(p.remove(n.orb),n.orb.geometry.dispose(),n.orb.material.dispose(),n.orb=null,console.log("orb removed for recombination")):n.orb.material.opacity<=.1?(n.object.material.color.set(new o.Color(383487)),n.lerpPartner.object.material.color.set(new o.Color(16751792))):console.log("orb not removed yet")):console.log("orb does not exist"),n.lerpProgress>=.6&&Xe(n,n.lerpPartner)}}function Xe(t,e){p.remove(t.object),p.remove(e.object),f=f.filter(r=>r!==t&&r!==e),d=d.filter(r=>r!==t&&r!==e),[t,e].forEach(r=>{r.object.geometry.dispose(),r.object.material.dispose()}),ee=!0}function Ze(){let t=new ue(o.MathUtils.randFloat(-c.x/2+1,c.x/2-1),o.MathUtils.randFloat(-c.y/2+1,c.y/2-1),o.MathUtils.randFloat(-c.z/2+1,c.z/2-1)),e=U(t.clone().add(new o.Vector3(2,0,0)),16724273,!1),r=U(t.clone(),2052607,!1);e.velocity=new o.Vector3(-.02,0,0),r.velocity=new o.Vector3(.02,0,0);const i=new o.SphereGeometry(2,32,32),n=new o.MeshBasicMaterial({color:65280,transparent:!0,opacity:.5}),a=new o.Mesh(i,n);let s=e.object.position.clone().add(r.object.position.clone()).multiplyScalar(.5);a.position.copy(s),a.gradualVal=.5,p.add(a),N.push({hole:e,electron:r,orbSphere:a,position:t})}function Ne(){let t=6;if(N.length>0){let e=0;for(let r of N){let i=r.hole,n=r.electron,a=r.orbSphere;if(a.gradualVal<=t&&a.material.opacity>0){i.object.position.add(i.velocity),n.object.position.add(n.velocity);let s=Math.max(0,1-(a.gradualVal-1)/(t-1));a.material.opacity=s,a.gradualVal+=.1}else p.remove(a),N.splice(e,1),d.push({value:"h",initPos:r.position.clone().add(new o.Vector3(2,0,0)),crossReady:!1,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,id:"generated",recombine:!1,canMove:!0,object:i.object,material:i.material,velocity:L(),speed:Math.random()*(I-P+1)+P,scatterStartTime:performance.now(),scatterTime:V+(C.noise(Math.random(0,h)*100,Math.random(0,h)*200,performance.now()*.001)-.5)*.3}),f.push({value:"e",initPos:r.position.clone(),crossReady:!1,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,id:"generated",recombine:!1,canMove:!0,object:n.object,material:n.material,velocity:L(),speed:Math.random()*(I-P+1)+P,scatterStartTime:performance.now(),scatterTime:V+(C.noise(Math.random(0,h)*100,Math.random(0,h)*200,performance.now()*.001)-.5)*.3});e++}}}function Ye(){for(let t of f)for(let e of d)if(t.initPos!=null&&e.initPos!=null){let r=t.object.position.distanceTo(t.initPos),i=e.object.position.distanceTo(e.initPos);r>ae&&i>ae&&(t.recombine=!0,e.recombine=!0)}}function Ke(t,e){let r=new ue().subVectors(t.object.position,e.object.position).length(),i=20;if(t.recombine&&e.recombine)return r<=i}function L(){let t=Q[Math.floor(Math.random()*Q.length)],e=Math.random()*Math.PI,r=Math.random()*(2*Math.PI);const i=t*Math.sin(e)*Math.cos(r),n=t*Math.sin(e)*Math.sin(r),a=t*Math.cos(e);return new o.Vector3(i,n,a).multiplyScalar(Re)}function Je(t){for(let e=0;e<f.length;e++)for(let r=0;r<d.length;r++)(t-f[e].scatterStartTime)/1e3>=f[e].scatterTime&&(f[e].velocity=L(),f[e].scatterStartTime=performance.now(),f[e].scatterTime=V+(C.noise(e*100,e*200,performance.now()*.001)-.5)*.3),(t-d[r].scatterStartTime)/1e3>=d[r].scatterTime&&(d[r].velocity=L(),d[r].scatterStartTime=performance.now(),d[r].scatterTime=V+(C.noise(r*100,r*200,performance.now()*.001)-.5)*.3)}function Qe(t,e,r,i){let n=c.y/2,a=-n,s=c.z/2,u=-s;for(let l=0;l<t.length;l++)t[l].object.position.x>=i?t[l].object.position.x=r+1:t[l].object.position.x<=r&&(t[l].object.position.x=o.MathUtils.randFloat(r+1,r+20)),t[l].object.position.y>n?(t[l].object.position.y=n-1,t[l].velocity.multiplyScalar(-1)):t[l].object.position.y<a&&(t[l].object.position.y=a+1,t[l].velocity.multiplyScalar(-1)),t[l].object.position.z>s?(t[l].object.position.z=s-1,t[l].velocity.multiplyScalar(-1)):t[l].object.position.z<u&&(t[l].object.position.z=u+1,t[l].velocity.multiplyScalar(-1));for(let l=0;l<e.length;l++)e[l].object.position.x>=i?e[l].object.position.x=o.MathUtils.randFloat(i-15,i-1):e[l].object.position.x<=r&&(e[l].object.position.x=i-1),e[l].object.position.y>n?(e[l].object.position.y=n-1,e[l].velocity.multiplyScalar(-1)):e[l].object.position.y<a&&(e[l].object.position.y=a+1,e[l].velocity.multiplyScalar(-1)),e[l].object.position.z>s?(e[l].object.position.z=s-1,e[l].velocity.multiplyScalar(-1)):e[l].object.position.z<u&&(e[l].object.position.z=u+1,e[l].velocity.multiplyScalar(-1))}function $e(){R.__controllers.forEach(t=>t.setValue(t.initialValue))}function me(t,e,r,i){let n=3,a=.5;const s=new o.CapsuleGeometry(a,n);if(i=="acceptor"){let u=new o.MeshBasicMaterial({color:r,transparent:!0,opacity:.2}),l=new o.Mesh(s,u);l.rotateZ(Math.PI/2),l.position.set(o.MathUtils.randFloat(t,e),o.MathUtils.randFloat(-c.y/2+1,c.y/2-1),o.MathUtils.randFloat(-c.z/2+1,c.z/2-1)),p.add(l)}else if(i=="donor"){let u=new o.CapsuleGeometry(a,n);u.rotateZ(Math.PI/2);let l=new Se.mergeGeometries([s,u]),F=new o.MeshBasicMaterial({color:r,transparent:!0,opacity:.2}),v=new o.Mesh(l,F);v.position.set(o.MathUtils.randFloat(t,e),o.MathUtils.randFloat(-c.y/2+1,c.y/2-1),o.MathUtils.randFloat(-c.z/2+1,c.z/2-1)),p.add(v)}}function pe(t,e,r,i,n){let a=null,s,u;s=new o.SphereGeometry(1,32,32),i===16724273?u=new o.MeshBasicMaterial({color:i,wireframe:!0}):u=new o.MeshBasicMaterial({color:i,transparent:n,opacity:a});const l=new o.Mesh(s,u);return l.position.set(o.MathUtils.randFloat(e,r),o.MathUtils.randFloat(-c.y/2+1,c.y/2-1),o.MathUtils.randFloat(-c.z/2+1,c.z/2-1)),p.add(l),{object:l,material:u}}function U(t,e,r){let i=null,n,a;n=new o.SphereGeometry(1,32,32),e===16724273?a=new o.MeshBasicMaterial({color:e,wireframe:!0}):a=new o.MeshBasicMaterial({color:e,transparent:r,opacity:i});const s=new o.Mesh(n,a);return s.position.set(t.x,t.y,t.z),p.add(s),{object:s,material:a}}function et(t,e,r){let i=g/4;p.remove(K),K=new o.ArrowHelper(new o.Vector3(-1,0,0),t,e,r,i),p.add(K)}function be(t,e,r){t=t*.5,e=e*.5,r=r*.5;const i=new o.BufferGeometry,n=[];return n.push(-t,-e,-r,-t,e,-r,-t,e,-r,t,e,-r,t,e,-r,t,-e,-r,t,-e,-r,-t,-e,-r,-t,-e,r,-t,e,r,-t,e,r,t,e,r,t,e,r,t,-e,r,t,-e,r,-t,-e,r,-t,-e,-r,-t,-e,r,-t,e,-r,-t,e,r,t,e,-r,t,e,r,t,-e,-r,t,-e,r),i.setAttribute("position",new o.Float32BufferAttribute(n,3)),i}function tt(){S.aspect=x.clientWidth/x.clientHeight,S.updateProjectionMatrix(),b.setSize(x.clientWidth,x.clientHeight,!1),b.setPixelRatio(Math.min(window.devicePixelRatio,2))}
